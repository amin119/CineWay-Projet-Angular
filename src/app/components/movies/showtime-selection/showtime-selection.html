<div class="min-h-screen bg-very-dark text-white">
  <main class="flex-1 px-6 md:px-10 py-8 md:py-12 max-w-7xl mx-auto">
    <!-- Loading State -->
    @if (loading()) {
      <div class="flex items-center justify-center py-20">
        <div
          class="h-12 w-12 animate-spin rounded-full border-4 border-border-dark border-t-primary"
        ></div>
      </div>
    }
    <!-- Error State -->
    @else if (error()) {
      <div class="flex flex-col items-center justify-center py-20">
        <div class="text-red-400 text-lg mb-4">{{ error() }}</div>
        <button
          (click)="goBack()"
          class="px-6 py-2 bg-primary hover:bg-primary-600 rounded-lg transition-colors"
        >
          Go Back
        </button>
      </div>
    }
    <!-- Content -->
    @else if (screening()) {
      <div class="flex flex-col gap-6 md:gap-8">
        <!-- Header -->
        <div class="flex items-center gap-3">
          <button
            (click)="goBack()"
            class="flex items-center justify-center w-8 h-8 rounded-full hover:bg-white/10 transition-colors text-gray-300"
          >
            <span class="material-symbols-outlined text-xl">‚Üê</span>
          </button>
          <h1 class="text-2xl md:text-3xl font-bold leading-tight tracking-[-0.015em]">
            Showtime & Ticket Selection
          </h1>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 md:gap-8">
          <!-- Left Column -->
          <div class="lg:col-span-2 flex flex-col gap-6 md:gap-8">
            <!-- Movie & Showtime Info -->
            <div class="flex flex-col sm:flex-row gap-6 p-6 bg-bg-dark rounded-xl">
              <!-- Movie Poster -->
              <div
                class="w-full sm:w-40 h-60 sm:h-auto shrink-0 bg-cover bg-center rounded-lg bg-white/5"
                [style.background-image]="'url(' + screening()?.movie?.image_url + ')'"
              ></div>

              <!-- Movie Details -->
              <div class="flex flex-col gap-4">
                <h2 class="text-xl md:text-2xl font-bold">
                  {{ screening()?.movie?.title || 'Movie Title' }}
                </h2>

                <div class="flex flex-col gap-3 text-gray-300 text-sm">
                  @if (screening()?.room?.cinema?.name) {
                    <div class="flex items-center gap-2">
                      <span class="bi bi-camera-reels text-lg"></span>
                      <span>{{ screening()?.room?.cinema?.name }}</span>
                    </div>
                  }

                  @if (screening()?.screening_time) {
                    <div class="flex items-center gap-2">
                      <span class="bi bi-calendar3 text-lg"></span>
                      <span>{{ formatDate(screening()!.screening_time) }}</span>
                    </div>

                    <div class="flex items-center gap-2">
                      <span class="bi bi-clock text-lg"></span>
                      <span>{{ formatTime(screening()!.screening_time) }}</span>
                    </div>
                  }

                  @if (screening()?.room?.name) {
                    <div class="flex items-center gap-2">
                      <span class="bi bi-film text-lg"></span>
                      <span>{{ screening()?.room?.name }} | Standard</span>
                    </div>
                  }
                </div>
              </div>
            </div>

            <!-- Ticket Selection -->
            <div class="flex flex-col gap-4 p-6 bg-bg-dark rounded-xl">
              <h3 class="text-lg md:text-xl font-bold">Select Your Tickets</h3>

              <div class="flex flex-col gap-4">
                @for (ticket of ticketTypes(); track ticket.id) {
                  <div
                    class="flex justify-between items-center"
                    [class.border-b]="!$last"
                    [class.border-white/10]="!$last"
                  >
                    <div>
                      <p class="text-white font-medium text-xl">{{ ticket.name }}</p>
                      @if (ticket.description) {
                        <p class="text-gray-400 text-sm">{{ ticket.description }}</p>
                      }
                      <p class="text-gray-400 text-sm">${{ ticket.price.toFixed(2) }}</p>
                    </div>

                    <div class="flex items-center gap-3">
                      <button
                        (click)="decrementTicket(ticket.id)"
                        [disabled]="ticket.count === 0"
                        class="flex items-center justify-center w-8 h-8 rounded-full bg-bg-medium-dark text-white hover:bg-white/20 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
                      >
                        -
                      </button>
                      <span class="text-white text-lg font-medium w-8 text-center">
                        {{ ticket.count }}
                      </span>
                      <button
                        (click)="incrementTicket(ticket.id)"
                        class="flex items-center justify-center w-8 h-8 rounded-full bg-bg-medium-dark text-white hover:bg-white/20 transition-colors"
                      >
                        +
                      </button>
                    </div>
                  </div>
                }
              </div>
            </div>
          </div>

          <!-- Right Column - Order Summary -->
          <div class="lg:col-span-1">
            <div class="p-6 bg-bg-dark rounded-xl flex flex-col gap-6 lg:sticky lg:top-10">
              <h3 class="text-lg md:text-xl font-bold border-b border-white/10 pb-4">
                Order Summary
              </h3>

              @if (totalTickets() > 0) {
                <div class="flex flex-col gap-4 text-sm">
                  @for (item of getTicketSummary(); track item.name) {
                    <div class="flex justify-between">
                      <span class="text-gray-300">{{ item.name }} x {{ item.count }}</span>
                      <span class="text-white">${{ item.price.toFixed(2) }}</span>
                    </div>
                  }

                  <div class="flex justify-between">
                    <span class="text-gray-300">Booking Fee</span>
                    <span class="text-white">${{ bookingFee().toFixed(2) }}</span>
                  </div>
                </div>
              } @else {
                <div class="text-gray-400 text-sm text-center py-4">No tickets selected</div>
              }

              <div class="border-t border-white/10 pt-4 flex justify-between items-center">
                <span class="text-white text-lg font-bold">Total</span>
                <span class="text-[#3d99f5] text-2xl font-bold"> ${{ total().toFixed(2) }} </span>
              </div>

              <button
                (click)="proceedToSeatSelection()"
                [disabled]="!canProceed()"
                class="flex w-full min-w-21 cursor-pointer items-center justify-center overflow-hidden rounded-lg h-12 px-4 bg-primary text-white text-base font-bold leading-normal tracking-[0.015em] hover:bg-primary-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
              >
                <span class="truncate">Select Seats</span>
              </button>
            </div>
          </div>
        </div>

        <!-- Other Showtimes -->
        @if (groupedOtherShowtimes().length > 0) {
          <div class="flex flex-col gap-4 p-6 bg-bg-dark rounded-xl">
            <h3 class="text-lg md:text-xl font-bold">Other Showtimes for This Movie</h3>

            <div class="space-y-4">
              @for (group of groupedOtherShowtimes(); track group.cinema.id) {
                <div class="bg-bg-medium-dark rounded-lg p-4">
                  <!-- Cinema Info -->
                  <h4 class="text-md font-semibold mb-3">{{ group.cinema.name }}</h4>

                  <!-- Showtimes -->
                  <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-2">
                    @for (showtime of group.showtimes; track showtime.id) {
                      <button
                        (click)="selectOtherShowtime(showtime.id)"
                        class="flex flex-col items-center justify-center p-3 bg-primary hover:bg-primary-600 rounded-lg transition-colors group"
                      >
                        <span class="text-sm font-bold group-hover:text-white">
                          {{ formatTime(showtime.screening_time) }}
                        </span>
                        <span class="text-xs text-gray-300 group-hover:text-white/80 mt-1">
                          {{ showtime.room?.name }}
                        </span>
                        <span class="text-xs text-gray-400 group-hover:text-white/60 mt-1">
                          ${{ showtime.price.toFixed(2) }}
                        </span>
                      </button>
                    }
                  </div>
                </div>
              }
            </div>
          </div>
        }
      </div>
    }
  </main>
</div>
